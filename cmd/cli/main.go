package main

import (
	"flag"
	"fmt"
	"os"

	"ryanbyrne30/malware-scanner/internal/resources/clamav"
	"ryanbyrne30/malware-scanner/internal/utils"
)

func main() {
	configPtr := flag.String("config", "/etc/clamav/clamd.conf", "Config file to use for clamdscan")
	flag.Parse()
	if !utils.FileExists(*configPtr) {
		panic(fmt.Sprintln("Config file does not exist:", *configPtr))
	}

	args := os.Args
	if len(args) < 2 {
		panic("File required")
	}
	files := args[1:]
	fmt.Println("Scanning files...")
	for _, f := range files {
		fmt.Println(f)
	}
	fmt.Println("=================")

	clamav := &clamav.Clamav{
		Config: *configPtr,
	}

	result, err := clamav.Scan(files)
	if err != nil {
		panic(err.Error())
	}

	for _, r := range result {
		fmt.Println(r.ToString())
	}
}